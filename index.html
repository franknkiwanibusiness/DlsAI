<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemma AI Picks</title>
    <style>
        :root {
            --ios-bg: #f2f2f7;
            --ios-card: #ffffff;
            --ios-blue: #007aff;
            --ios-green: #34c759;
            --ios-secondary: #8e8e93;
            --ios-border: #c6c6c8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui; }
        body { background: var(--ios-bg); padding-bottom: 100px; }

        header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(242, 242, 247, 0.85); backdrop-filter: blur(20px);
            padding: 20px 16px 10px; border-bottom: 0.5px solid var(--ios-border);
        }
        h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }

        .container { padding: 12px; }
        .card {
            background: var(--ios-card); border-radius: 14px; 
            margin-bottom: 16px; padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .match-header { font-size: 11px; color: var(--ios-secondary); font-weight: 600; margin-bottom: 8px; text-transform: uppercase; }
        .teams { font-size: 18px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        
        /* AI Prediction Badge */
        .ai-pick-container {
            background: #f0f9f1; border-radius: 10px; padding: 12px;
            border: 1px dashed var(--ios-green);
        }
        .ai-label { font-size: 10px; color: var(--ios-green); font-weight: 800; text-transform: uppercase; margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }
        .market-name { font-size: 15px; font-weight: 600; color: #1a1a1a; }
        .odds-value { float: right; color: var(--ios-blue); font-weight: 800; font-size: 16px; }

        .tab-bar {
            position: fixed; bottom: 0; width: 100%; height: 85px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px);
            border-top: 0.5px solid var(--ios-border); display: flex;
        }
        .tab-item { flex: 1; text-align: center; color: var(--ios-secondary); padding-top: 10px; }
        .tab-item.active { color: var(--ios-blue); }
        .tab-label { font-size: 10px; margin-top: 2px; }
    </style>
</head>
<body>

<header>
    <h1 id="view-title">Gemma AI Picks</h1>
</header>

<div class="container" id="main-content">
    <div style="text-align:center; padding:50px; color:#888;">Analyzing Markets...</div>
</div>

<nav class="tab-bar">
    <div class="tab-item active" onclick="fetchAndAnalyze('soccer_epl', 'Premier League', this)">
        <div style="font-size:22px">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</div><div class="tab-label">EPL</div>
    </div>
    <div class="tab-item" onclick="fetchAndAnalyze('soccer_spain_la_liga', 'La Liga', this)">
        <div style="font-size:22px">üá™üá∏</div><div class="tab-label">LaLiga</div>
    </div>
    <div class="tab-item" onclick="fetchAndAnalyze('soccer_italy_serie_a', 'Serie A', this)">
        <div style="font-size:22px">üáÆüáπ</div><div class="tab-label">Serie A</div>
    </div>
</nav>

<script>
    const ODDS_API_KEY = '826ccd6998728ab23f00ac7ad0546c2b';

    async function fetchAndAnalyze(sportKey, title, el) {
        document.getElementById('view-title').innerText = title;
        document.getElementById('main-content').innerHTML = '<div style="text-align:center; padding:50px; color:#888;">Gemma AI is calculating probabilities...</div>';
        
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        if(el) el.classList.add('active');

        try {
            // Fetching H2H and Totals (Over/Under) to give the AI options
            const url = `https://api.the-odds-api.com/v4/sports/${sportKey}/odds/?apiKey=${ODDS_API_KEY}&regions=uk&markets=h2h,totals&oddsFormat=decimal`;
            const response = await fetch(url);
            const data = await response.json();
            
            renderAIContent(data);
        } catch (error) {
            document.getElementById('main-content').innerHTML = `<div style="color:red; text-align:center; padding:20px;">Check API Key or Vercel Config</div>`;
        }
    }

    function gemmaBrain(match) {
        // AI LOGIC: Analyzes odds to find the most "stable" or "value" outcome
        const bookie = match.bookmakers[0];
        if (!bookie) return { market: "No Market", odd: "-" };

        const h2h = bookie.markets.find(m => m.key === 'h2h');
        const totals = bookie.markets.find(m => m.key === 'totals');

        // Logic: If a favorite is heavily backed (e.g. odds < 1.50), pick 1X2 Win
        // If odds are tight, look at Over 2.5 Goals
        const homePrice = h2h?.outcomes.find(o => o.name === match.home_team)?.price || 3.0;
        const awayPrice = h2h?.outcomes.find(o => o.name === match.away_team)?.price || 3.0;

        if (homePrice < 1.60) return { market: `${match.home_team} to Win`, odd: homePrice };
        if (awayPrice < 1.60) return { market: `${match.away_team} to Win`, odd: awayPrice };
        
        // If game is balanced, Gemma favors Goals or Corners (simulated logic)
        if (totals) {
            const over25 = totals.outcomes.find(o => o.name === 'Over' && o.point === 2.5);
            if (over25) return { market: "Over 2.5 Goals", odd: over25.price };
        }

        return { market: "Draw No Bet (Home)", odd: (homePrice * 0.8).toFixed(2) };
    }

    function renderAIContent(matches) {
        const container = document.getElementById('main-content');
        container.innerHTML = matches.slice(0, 15).map(match => {
            const pick = gemmaBrain(match);
            const date = new Date(match.commence_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            return `
                <div class="card">
                    <div class="match-header">${date} ‚Ä¢ ${match.home_team} vs ${match.away_team}</div>
                    <div class="ai-pick-container">
                        <div class="ai-label">‚ú® GEMMA AI BEST OUTCOME</div>
                        <div>
                            <span class="market-name">${pick.market}</span>
                            <span class="odds-value">${pick.odd}</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    fetchAndAnalyze('soccer_epl', 'Premier League');
</script>
</body>
</html>
