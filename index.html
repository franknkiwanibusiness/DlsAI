<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Multiplier Scout | Easybet Edition</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --text: #f1f5f9; --disco: transparent; }
        
        /* THEMES */
        body.light { --bg: #f8fafc; --card: #ffffff; --accent: #0284c7; --text: #0f172a; }
        body.blue { --bg: #1e3a8a; --card: #1e40af; --accent: #60a5fa; --text: #eff6ff; }
        body.disco { animation: discoBg 2s infinite; }
        @keyframes discoBg { 0% { background: #ff0000; } 20% { background: #00ff00; } 40% { background: #0000ff; } 60% { background: #ffff00; } 80% { background: #ff00ff; } 100% { background: #ff0000; } }

        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; transition: 0.3s; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        
        .card { background: var(--card); border: 2px solid #334155; padding: 15px; border-radius: 12px; cursor: pointer; position: relative; }
        .card.selected { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .badge { background: var(--accent); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7em; position: absolute; top: 10px; right: 10px; }
        
        .ai-scout { background: #00000066; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.85em; display: none; border-left: 3px solid #fbbf24; }
        
        .slip { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; padding: 20px; border-top: 3px solid var(--accent); box-shadow: 0 -5px 20px rgba(0,0,0,0.5); }
        .payout-warning { color: #f87171; font-weight: bold; font-size: 0.9em; margin-top: 5px; }

        /* SETTINGS PANEL */
        #settingsModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1e293b; border: 2px solid var(--accent); padding: 25px; border-radius: 15px; z-index: 1000; width: 300px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: var(--accent); color: white; }
    </style>
</head>
<body>

    <div class="header">
        <h1>üèÜ AI Scout</h1>
        <button class="btn btn-blue" onclick="toggleSettings()">‚öôÔ∏è Settings</button>
    </div>

    <div id="status" style="font-size: 0.8em; opacity: 0.8; margin-top: 5px;">Ready</div>
    <div id="matches" class="grid"></div>

    <div class="slip">
        <div style="display: flex; justify-content: space-between;">
            <div>
                <strong>Stake: R<span id="displayStake">10</span></strong> | 
                <strong>Total Odds: <span id="totalOdds">1.00</span></strong>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 1.2em;">Potential Payout: <strong id="payout">R0.00</strong></div>
                <div id="capWarning" class="payout-warning"></div>
            </div>
        </div>
    </div>

    <div id="overlay" class="overlay" onclick="toggleSettings()"></div>
    <div id="settingsModal">
        <h3>App Settings</h3>
        <label>Theme:</label><br>
        <select id="themeSelect" onchange="changeTheme()" style="width: 100%; padding: 8px; margin: 10px 0;">
            <option value="dark">Dark Mode</option>
            <option value="light">Light Mode</option>
            <option value="blue">Electric Blue</option>
            <option value="disco">Disco (Color Cycle)</option>
        </select>
        <br><br>
        <label>Default Stake (ZAR):</label><br>
        <input type="number" id="stakeInput" value="10" onchange="saveStake()" style="width: 90%; padding: 8px; margin: 10px 0;">
        <br><br>
        <button class="btn btn-blue" onclick="toggleSettings()" style="width: 100%;">Save & Close</button>
    </div>

    <script>
        const ODDS_API_KEY = 'YOUR_ODDS_API_KEY';
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY';
        const EASYBET_CAP = 2000000; // R2 Million Cap
        
        let selectedOdds = new Map();
        let currentStake = 10;

        // 1. INITIALIZE & CACHE
        async function init() {
            const savedStake = localStorage.getItem('userStake');
            if (savedStake) {
                currentStake = savedStake;
                document.getElementById('stakeInput').value = savedStake;
                document.getElementById('displayStake').innerText = savedStake;
            }

            const cache = JSON.parse(localStorage.getItem('odds_cache_24h'));
            if (cache && (Date.now() - cache.timestamp < 24 * 60 * 60 * 1000)) {
                document.getElementById('status').innerText = "Using Cached Odds (24h Protected)";
                render(cache.data);
            } else {
                fetchOdds();
            }
        }

        async function fetchOdds() {
            document.getElementById('status').innerText = "üì° Syncing Live Fixtures...";
            const leagues = ['soccer_epl', 'soccer_spain_la_liga', 'soccer_italy_serie_a', 'soccer_germany_bundesliga', 'soccer_uefa_champs_league'];
            let allMatches = [];

            for (const l of leagues) {
                try {
                    const res = await fetch(`https://api.the-odds-api.com/v4/sports/${l}/odds/?apiKey=${ODDS_API_KEY}&regions=uk&markets=h2h,totals&oddsFormat=decimal`);
                    const data = await res.json();
                    allMatches = allMatches.concat(data);
                } catch (e) { console.error("League fail:", l); }
            }

            localStorage.setItem('odds_cache_24h', JSON.stringify({ timestamp: Date.now(), data: allMatches }));
            render(allMatches);
        }

        // 2. GEMINI 3 FLASH RESEARCH (GOOGLE SEARCH GROUNDING)
        async function getAiScout(home, away, cardId) {
            const scoutDiv = document.querySelector(`#card-${cardId} .ai-scout`);
            scoutDiv.style.display = 'block';
            scoutDiv.innerText = "üîç Gemini 3 Flash is browsing live lineups & news...";

            const prompt = `Perform a Google Search for ${home} vs ${away} (Feb 2026). Summarize major injuries, suspended players, and the 1st leg score if applicable. End with a 1-sentence verdict on the 'Over 2.5 Goals' or 'Win' market.`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        tools: [{ google_search: {} }] 
                    })
                });
                const json = await res.json();
                scoutDiv.innerHTML = `<strong>AI SCOUT REPORT:</strong><br>${json.candidates[0].content.parts[0].text}`;
            } catch (e) {
                scoutDiv.innerText = "‚ö†Ô∏è Search failed. Market odds suggest high probability.";
            }
        }

        // 3. UI LOGIC
        function toggleMatch(id, odd, home, away) {
            const card = document.getElementById(`card-${id}`);
            if (selectedOdds.has(id)) {
                selectedOdds.delete(id);
                card.classList.remove('selected');
                card.querySelector('.ai-scout').style.display = 'none';
            } else {
                selectedOdds.set(id, odd);
                card.classList.add('selected');
                getAiScout(home, away, id);
            }
            calculateTicket();
        }

        function calculateTicket() {
            let total = 1;
            selectedOdds.forEach(val => total *= val);
            if (selectedOdds.size === 0) total = 0;

            document.getElementById('totalOdds').innerText = total.toFixed(2);
            let rawPayout = total * currentStake;
            
            if (rawPayout > EASYBET_CAP) {
                document.getElementById('payout').innerText = `R${EASYBET_CAP.toLocaleString()}`;
                document.getElementById('capWarning').innerText = `‚ö†Ô∏è Easybet Cap Reached (Max R2 Million)`;
            } else {
                document.getElementById('payout').innerText = `R${rawPayout.toFixed(2)}`;
                document.getElementById('capWarning').innerText = "";
            }
        }

        function render(matches) {
            const grid = document.getElementById('matches');
            grid.innerHTML = matches.map((m, i) => {
                const h2h = m.bookmakers[0]?.markets[0]?.outcomes[0]?.price || 1.90;
                return `
                <div class="card" id="card-${i}" onclick="toggleMatch(${i}, ${h2h}, '${m.home_team}', '${m.away_team}')">
                    <span class="badge">EASYBET READY</span>
                    <div style="opacity: 0.6; font-size: 0.8em;">${m.sport_title}</div>
                    <div style="margin: 10px 0;"><strong>${m.home_team} vs ${m.away_team}</strong></div>
                    <div style="color: var(--accent); font-weight: bold;">Market: Home Win @${h2h}</div>
                    <div class="ai-scout"></div>
                </div>
            `}).join('');
        }

        // SETTINGS FUNCTIONS
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            const overlay = document.getElementById('overlay');
            const isVisible = modal.style.display === 'block';
            modal.style.display = isVisible ? 'none' : 'block';
            overlay.style.display = isVisible ? 'none' : 'block';
        }

        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            document.body.className = theme;
        }

        function saveStake() {
            currentStake = document.getElementById('stakeInput').value;
            localStorage.setItem('userStake', currentStake);
            document.getElementById('displayStake').innerText = currentStake;
            calculateTicket();
        }

        init();
    </script>
</body>
</html>
