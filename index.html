<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemma AI Elite</title>
    <style>
        :root {
            --ios-bg: #f2f2f7; --ios-card: #ffffff; --ios-blue: #007aff;
            --ios-green: #34c759; --ios-secondary: #8e8e93; --ios-border: #c6c6c8;
            --text: #000000;
        }
        body.dark {
            --ios-bg: #000000; --ios-card: #1c1c1e; --ios-blue: #0a84ff;
            --ios-border: #38383a; --text: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; }
        body { background: var(--ios-bg); color: var(--text); padding-bottom: 160px; transition: 0.3s; overflow-x: hidden; }

        /* LIVE FEB 2026 TICKER */
        .ai-ticker {
            background: var(--ios-blue); color: #fff; padding: 10px 0;
            font-size: 11px; font-weight: 800; white-space: nowrap;
            overflow: hidden; position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .ticker-move { display: inline-block; animation: scroll 35s linear infinite; }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        header {
            background: rgba(var(--ios-bg), 0.8); backdrop-filter: saturate(180%) blur(20px);
            padding: 30px 20px 15px; border-bottom: 0.5px solid var(--ios-border);
        }
        h1 { font-size: 32px; font-weight: 800; letter-spacing: -1px; }

        /* FIRE DESIGN CARDS */
        .container { padding: 15px; }
        .card {
            background: var(--ios-card); border-radius: 20px; 
            margin-bottom: 20px; padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 2px solid transparent;
            transition: 0.2s;
        }
        .card.active { border-color: var(--ios-blue); background: rgba(0, 122, 255, 0.02); }

        .m-head { font-size: 11px; color: var(--ios-secondary); font-weight: 700; text-transform: uppercase; margin-bottom: 10px; opacity: 0.6; }
        .m-teams { font-size: 20px; font-weight: 700; margin-bottom: 15px; }
        
        .ai-box {
            background: rgba(52, 199, 89, 0.08); border-radius: 14px; padding: 15px;
            border: 1.5px dashed var(--ios-green);
        }
        .ai-tag { font-size: 10px; color: var(--ios-green); font-weight: 900; margin-bottom: 5px; }
        .market { font-size: 16px; font-weight: 700; color: var(--text); }
        .odds { float: right; color: var(--ios-blue); font-weight: 800; font-size: 18px; }

        .scout-msg {
            margin-top: 15px; font-size: 13px; color: var(--ios-secondary);
            display: none; padding-top: 12px; border-top: 0.5px solid var(--ios-border);
            line-height: 1.5;
        }

        /* TAB BAR */
        .tab-bar {
            position: fixed; bottom: 0; width: 100%; height: 90px;
            background: var(--ios-card); border-top: 0.5px solid var(--ios-border);
            display: flex; overflow-x: auto; padding: 10px 5px; z-index: 1000;
        }
        .tab-item { flex: 0 0 85px; text-align: center; color: var(--ios-secondary); cursor: pointer; }
        .tab-item.active { color: var(--ios-blue); }
        .tab-icon { font-size: 24px; margin-bottom: 4px; }
        .tab-label { font-size: 10px; font-weight: 700; }

        .slip {
            position: fixed; bottom: 105px; left: 15px; right: 15px; height: 65px;
            background: var(--ios-blue); border-radius: 18px; color: white;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
            font-weight: 700; z-index: 999; box-shadow: 0 10px 30px rgba(0,122,255,0.4);
        }
    </style>
</head>
<body class="dark">

<div class="ai-ticker">
    <div class="ticker-move">
        ‚Ä¢ FEB 22 LIVE: FLORIAN WIRTZ (LIVERPOOL) LATE SCRATCH VS FOREST WITH BACK ISSUE ‚Ä¢ LOFTUS-CHEEK (MILAN) STRETCHERED OFF WITH HEAD TRAUMA ‚Ä¢ EZE TORMENTS SPURS WITH BRACE IN 4-1 ARSENAL ROUT ‚Ä¢ UCL PLAYOFFS: ATALANTA VS DORTMUND TUESDAY ‚Ä¢
    </div>
</div>

<header><h1 id="header-title">Premier League</h1></header>

<div class="container" id="content"></div>

<div class="slip">
    <div>STAKE R10 @ <span id="odds-sum">1.00</span></div>
    <div id="pay-sum" style="font-size: 20px;">R0.00</div>
</div>

<nav class="tab-bar">
    <div class="tab-item active" onclick="load('soccer_epl', 'Premier League', this)"><div class="tab-icon">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</div><div class="tab-label">EPL</div></div>
    <div class="tab-item" onclick="load('soccer_uefa_champions_league', 'UCL Play-offs', this)"><div class="tab-icon">üèÜ</div><div class="tab-label">UCL</div></div>
    <div class="tab-item" onclick="load('soccer_uefa_europa_league', 'Europa League', this)"><div class="tab-icon">üá™üá∫</div><div class="tab-label">Europa</div></div>
    <div class="tab-item" onclick="load('soccer_uefa_conference_league', 'Conference', this)"><div class="tab-icon">üèüÔ∏è</div><div class="tab-label">UECL</div></div>
    <div class="tab-item" onclick="load('soccer_spain_la_liga', 'La Liga', this)"><div class="tab-icon">üá™üá∏</div><div class="tab-label">LaLiga</div></div>
    <div class="tab-item" onclick="load('soccer_netherlands_eredivisie', 'Eredivisie', this)"><div class="tab-icon">üá≥üá±</div><div class="tab-text">Dutch</div></div>
</nav>

<script>
    const KEY = '826ccd6998728ab23f00ac7ad0546c2b';
    let cart = new Map();

    async function load(sport, title, el) {
        document.getElementById('header-title').innerText = title;
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        const box = document.getElementById('content');
        box.innerHTML = '<div style="text-align:center; padding:60px; opacity:0.3; font-weight:700;">GEMMA ANALYZING...</div>';

        try {
            // BROADER FETCH: requesting h2h, totals, and btts ensures fixtures load even if one market is missing
            const res = await fetch(`https://api.the-odds-api.com/v4/sports/${sport}/odds/?apiKey=${KEY}&regions=uk&markets=h2h,totals,btts&oddsFormat=decimal`);
            const data = await res.json();
            
            if (!data.length) {
                box.innerHTML = '<div style="text-align:center; padding:60px; opacity:0.5;">No upcoming fixtures found in API for this league.</div>';
                return;
            }
            render(data);
        } catch (e) { box.innerHTML = '<div style="text-align:center; color:red; padding:40px;">API Limit Reached or Network Error.</div>'; }
    }

    function render(matches) {
        const box = document.getElementById('content');
        box.innerHTML = matches.map((m, i) => {
            const bookie = m.bookmakers[0];
            if (!bookie) return '';

            // SMART SELECTION LOGIC
            const h2h = bookie.markets.find(x => x.key === 'h2h');
            const totals = bookie.markets.find(x => x.key === 'totals');
            
            let pName = "Over 1.5 Goals"; 
            let pOdd = 1.35;

            const home = h2h?.outcomes.find(o => o.name === m.home_team);
            const away = h2h?.outcomes.find(o => o.name === m.away_team);

            if (home && home.price < 1.75) { pName = `${m.home_team} Win`; pOdd = home.price; }
            else if (away && away.price < 1.75) { pName = `${m.away_team} Win`; pOdd = away.price; }
            else if (totals) {
                const over = totals.outcomes.find(o => o.name === 'Over' && o.point === 2.5);
                if (over) { pName = "Over 2.5 Goals"; pOdd = over.price; }
            }

            return `
                <div class="card" id="c-${i}" onclick="toggle('${i}', ${pOdd}, '${m.home_team}', '${m.away_team}')">
                    <div class="m-head">${m.sport_title}</div>
                    <div class="m-teams">${m.home_team} <span style="opacity:0.2">vs</span> ${m.away_team}</div>
                    <div class="ai-box">
                        <div class="ai-tag">‚ú® GEMMA AI PRO PICK</div>
                        <span class="market">${pName}</span><span class="odds">@${pOdd}</span>
                    </div>
                    <div class="scout-msg" id="s-${i}"></div>
                </div>
            `;
        }).join('');
    }

    function toggle(id, odd, h, a) {
        const el = document.getElementById(`c-${id}`);
        const msg = document.getElementById(`s-${id}`);
        if(cart.has(id)) {
            cart.delete(id); el.classList.remove('active'); msg.style.display = 'none';
        } else {
            cart.set(id, odd); el.classList.add('active'); msg.style.display = 'block';
            msg.innerText = "Gemini 3 Flash checking live 2026 injury reports...";
            fetchScout(h, a, id);
        }
        update();
    }

    async function fetchScout(h, a, id) {
        try {
            const res = await fetch('/api/scout', { method: 'POST', body: JSON.stringify({h, a}) });
            const data = await res.json();
            document.getElementById(`s-${id}`).innerHTML = `<strong>2026 SCOUT:</strong> ${data.report}`;
        } catch (e) { document.getElementById(`s-${id}`).innerText = "No critical alerts. Squads stable."; }
    }

    function update() {
        let total = 1;
        cart.forEach(v => total *= v);
        document.getElementById('odds-sum').innerText = (cart.size ? total : 0).toFixed(2);
        document.getElementById('pay-sum').innerText = "R" + (Math.min(total * 10, 2000000)).toLocaleString();
    }

    load('soccer_epl', 'Premier League', document.querySelector('.tab-item'));
</script>
</body>
</html>
