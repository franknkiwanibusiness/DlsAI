<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GROQ-Bets | Research Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #000; color: #fff; }
        .brutal-card { border: 2px solid #333; background: #111; border-radius: 24px; transition: 0.3s; }
        .brutal-card:hover { border-color: #A3FF12; }
        .groq-glow { text-shadow: 0 0 10px rgba(163, 255, 18, 0.5); }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body x-data="betApp()" class="pb-20">

    <nav class="p-6 border-b border-white/10 flex justify-between items-center bg-black/80 backdrop-blur-md sticky top-0 z-50">
        <div>
            <h1 class="text-xl font-black tracking-tighter uppercase italic">GROQ<span class="text-lime-400">RESEARCH</span></h1>
            <p class="text-[8px] font-bold text-white/40 uppercase" x-text="cacheStatus"></p>
        </div>
        <button @click="refreshData()" class="bg-lime-400 text-black px-4 py-2 rounded-full text-[10px] font-black uppercase hover:scale-105 active:scale-95 transition">
            Sync Fixtures ðŸ“¡
        </button>
    </nav>

    <main class="p-4 max-w-2xl mx-auto space-y-4">
        <template x-if="loading">
            <div class="py-20 text-center space-y-4">
                <div class="w-12 h-12 border-4 border-lime-400 border-t-transparent rounded-full animate-spin mx-auto"></div>
                <p class="text-[10px] font-black uppercase tracking-widest text-lime-400">Loading Feb 26, 2026 Fixtures...</p>
            </div>
        </template>

        <template x-for="match in fixtures" :key="match.id">
            <div class="brutal-card p-5 relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <span class="text-[9px] font-black uppercase tracking-widest text-white/30" x-text="match.league"></span>
                    <span class="text-[9px] font-bold text-lime-400" x-text="match.time"></span>
                </div>

                <div class="flex justify-between items-center mb-6 px-2">
                    <div class="text-xs font-black uppercase w-1/3" x-text="match.home"></div>
                    <div class="text-[10px] font-black text-white/20 italic">VS</div>
                    <div class="text-xs font-black uppercase w-1/3 text-right" x-text="match.away"></div>
                </div>

                <div class="bg-white/5 rounded-2xl p-4 border border-white/5 relative">
                    <template x-if="match.loadingAI">
                        <div class="space-y-2">
                            <div class="h-2 w-full bg-white/10 rounded animate-pulse"></div>
                            <div class="h-2 w-2/3 bg-white/10 rounded animate-pulse"></div>
                            <p class="text-[8px] font-black text-lime-400/50 uppercase mt-2">Llama-3.3 Deep Researching...</p>
                        </div>
                    </template>

                    <template x-if="!match.loadingAI">
                        <div x-cloak>
                            <p class="text-[11px] font-medium leading-relaxed text-white/80 mb-3" x-text="match.analysis"></p>
                            <div class="flex justify-between items-center">
                                <div class="bg-lime-400 text-black px-2 py-1 rounded text-[9px] font-black uppercase" x-text="match.best_market"></div>
                                <div class="text-[10px] font-black text-white/30" x-text="`Odds: ${match.price}`"></div>
                            </div>
                        </div>
                    </template>
                </div>

                <div class="absolute bottom-2 right-4 text-[7px] font-bold text-white/10 uppercase" x-show="match.speed">
                    Processed in <span x-text="match.speed"></span>ms
                </div>
            </div>
        </template>
    </main>

    <script>
        function betApp() {
            return {
                fixtures: [],
                loading: true,
                cacheStatus: 'Checking Cache...',
                async init() {
                    const cached = localStorage.getItem('fb_cache_v2');
                    const FORTY_EIGHT_HOURS = 48 * 60 * 60 * 1000;

                    if (cached) {
                        const { timestamp, data } = JSON.parse(cached);
                        if (Date.now() - timestamp < FORTY_EIGHT_HOURS) {
                            this.fixtures = data;
                            this.loading = false;
                            this.cacheStatus = `Cache Valid: ${new Date(timestamp).toLocaleTimeString()}`;
                            this.triggerAIResearch();
                            return;
                        }
                    }
                    await this.refreshData();
                },

                async refreshData() {
                    this.loading = true;
                    try {
                        const leagues = ['soccer_epl', 'soccer_spain_la_liga', 'soccer_italy_serie_a', 'soccer_germany_bundesliga'];
                        const promises = leagues.map(l => 
                            fetch(`https://api.the-odds-api.com/v4/sports/${l}/odds/?apiKey=10257181b61bdaba7ac4ca4e276c9dae&regions=uk&markets=h2h&oddsFormat=decimal`)
                            .then(r => r.json())
                        );
                        
                        const results = await Promise.all(promises);
                        this.fixtures = results.flat().slice(0, 15).map(f => ({
                            id: f.id,
                            home: f.home_team,
                            away: f.away_team,
                            league: f.sport_title,
                            time: new Date(f.commence_time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', weekday:'short'}),
                            price: f.bookmakers[0]?.markets[0]?.outcomes[0]?.price || 'N/A',
                            loadingAI: true,
                            analysis: '',
                            best_market: '',
                            speed: 0
                        }));

                        this.save();
                        this.loading = false;
                        this.triggerAIResearch();
                    } catch (e) { this.loading = false; }
                },

                triggerAIResearch() {
                    this.fixtures.filter(m => m.loadingAI).forEach((m, i) => {
                        setTimeout(() => this.fetchGroq(m), i * 1200); // Stagger for API safety
                    });
                },

                async fetchGroq(match) {
                    const start = Date.now();
                    try {
                        const res = await fetch('/api/bet', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ home: match.home, away: match.away, league: match.league })
                        });
                        const data = await res.json();
                        match.analysis = data.scenario;
                        match.best_market = data.best_market;
                        match.speed = Date.now() - start;
                        match.loadingAI = false;
                        this.save();
                    } catch (e) { match.loadingAI = false; }
                },

                save() {
                    localStorage.setItem('fb_cache_v2', JSON.stringify({
                        timestamp: Date.now(),
                        data: this.fixtures
                    }));
                }
            }
        }
    </script>
</body>
</html>
