<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BETSMART | TERMINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
            --green: #00FF9F;
            --pink: #FF00E6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; }

        /* HEADER: NAME LEFT, DATE RIGHT */
        header {
            position: fixed; top: 0; width: 100%; height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 25px; z-index: 1000;
            background: var(--glass); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .logo { font-family: 'Syncopate', sans-serif; font-size: 16px; letter-spacing: 4px; }
        .logo span { color: var(--green); }
        .header-date { font-family: 'Syncopate', sans-serif; font-size: 10px; color: #555; }

        main { padding: 100px 20px 40px; max-width: 480px; margin: 0 auto; }

        /* FIXTURE CARD */
        .fixture-card {
            background: #0a0a0a;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .fixture-top { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .league-tag { font-size: 9px; text-transform: uppercase; color: #444; font-weight: 700; letter-spacing: 1px; }
        .match-time { font-size: 10px; color: #444; }

        .teams-grid { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; text-align: center; margin-bottom: 20px; }
        .team-box .name { font-weight: 700; font-size: 14px; margin-bottom: 4px; }
        .team-box .odds { font-family: 'Syncopate', sans-serif; font-size: 11px; }
        .home .odds { color: var(--green); }
        .away .odds { color: var(--pink); }
        .vs-divider { font-size: 10px; color: #222; font-weight: 900; }

        /* AI BEST MARKET BOX */
        .gemma-pick {
            border-top: 1px solid var(--border);
            padding-top: 15px;
            text-align: center;
        }

        .market-label { font-size: 9px; color: #555; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
        .market-value { font-size: 14px; font-weight: 700; color: #fff; }

        .research-btn {
            margin-top: 10px; width: 100%; padding: 10px;
            background: #fff; color: #000; border: none; border-radius: 6px;
            font-family: 'Syncopate', sans-serif; font-size: 9px; cursor: pointer;
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">BET<span>SMART</span></div>
        <div class="header-date" id="current-date">--/--/--</div>
    </header>

    <main id="fixture-list">
        </main>

    <script>
        // Update current date in header
        const updateHeaderDate = () => {
            const now = new Date();
            const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
            document.getElementById('current-date').innerText = now.toLocaleDateString('en-GB', options);
        };

        async function getGemmaPick(home, away, league, id) {
            const resultEl = document.getElementById(`pick-${id}`);
            const btnEl = document.getElementById(`btn-${id}`);
            
            btnEl.innerText = "RESEARCHING...";
            btnEl.disabled = true;

            try {
                const res = await fetch(`/api/gemma?home=${encodeURIComponent(home)}&away=${encodeURIComponent(away)}&league=${encodeURIComponent(league)}`);
                const data = await res.json();
                
                // Show ONLY the market
                resultEl.innerText = data.insight.split('|')[0].trim();
                btnEl.style.display = 'none';
                resultEl.parentElement.style.display = 'block';
            } catch (e) {
                btnEl.innerText = "RETRY RESEARCH";
                btnEl.disabled = false;
            }
        }

        // Dummy renderer for preview
        function renderFixtures(games) {
            const list = document.getElementById('fixture-list');
            list.innerHTML = '';

            games.forEach((g, i) => {
                const hO = g.bookmakers[0]?.markets[0]?.outcomes[0]?.price || '2.00';
                const aO = g.bookmakers[0]?.markets[0]?.outcomes[1]?.price || '2.00';

                list.innerHTML += `
                    <div class="fixture-card">
                        <div class="fixture-top">
                            <span class="league-tag">${g.sport_title}</span>
                            <span class="match-time">Today 22:00</span>
                        </div>
                        <div class="teams-grid">
                            <div class="team-box home"><div class="name">${g.home_team}</div><div class="odds">${hO}</div></div>
                            <div class="vs-divider">VS</div>
                            <div class="team-box away"><div class="name">${g.away_team}</div><div class="odds">${aO}</div></div>
                        </div>
                        <div class="gemma-pick">
                            <div class="market-label">Gemma Best Market</div>
                            <div id="pick-${i}" class="market-value"></div>
                            <button id="btn-${i}" class="research-btn" onclick="getGemmaPick('${g.home_team}','${g.away_team}','${g.sport_title}',${i})">RUN RESEARCH</button>
                        </div>
                    </div>`;
            });
        }

        updateHeaderDate();
        // Placeholder games to test the UI
        renderFixtures([{ home_team: 'Wolverhampton', away_team: 'Aston Villa', sport_title: 'EPL', bookmakers: [] }]);
    </script>
</body>
</html>
