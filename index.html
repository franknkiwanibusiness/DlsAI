<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemma AI Elite</title>
    <style>
        :root {
            --ios-bg: #f2f2f7; --ios-card: #ffffff; --ios-blue: #007aff;
            --ios-green: #34c759; --ios-secondary: #8e8e93; --ios-border: #c6c6c8;
            --text: #000000; --sheet-bg: rgba(255, 255, 255, 0.8);
        }
        body.dark {
            --ios-bg: #000000; --ios-card: #1c1c1e; --ios-blue: #0a84ff;
            --ios-border: #38383a; --text: #ffffff; --sheet-bg: rgba(28, 28, 30, 0.9);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--ios-bg); color: var(--text); padding-bottom: 180px; transition: background 0.4s; overflow-x: hidden; }

        /* Modern Header */
        header {
            position: sticky; top: 0; z-index: 100;
            background: var(--sheet-bg); backdrop-filter: saturate(180%) blur(20px);
            padding: 50px 20px 15px; border-bottom: 0.5px solid var(--ios-border);
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        h1 { font-size: 32px; font-weight: 800; letter-spacing: -1px; }

        /* Clean Modern Cards */
        .card {
            background: var(--ios-card); border-radius: 20px; 
            margin: 15px; padding: 20px; border: 1px solid transparent;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); transition: transform 0.2s, border 0.2s;
        }
        .card:active { transform: scale(0.98); }
        .card.selected { border-color: var(--ios-blue); background: rgba(0, 122, 255, 0.03); }

        .league-info { font-size: 11px; font-weight: 700; color: var(--ios-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .match-teams { font-size: 19px; font-weight: 700; margin-bottom: 15px; }

        .ai-engine-box {
            background: rgba(52, 199, 89, 0.08); border-radius: 15px; padding: 15px;
            border: 1px solid rgba(52, 199, 89, 0.2);
        }
        .engine-label { font-size: 10px; color: var(--ios-green); font-weight: 800; display: flex; align-items: center; gap: 5px; margin-bottom: 5px; }
        .market-val { font-size: 16px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }

        /* Research Section */
        .research-panel { 
            margin-top: 15px; padding-top: 15px; border-top: 0.5px solid var(--ios-border);
            font-size: 13px; line-height: 1.5; color: var(--ios-secondary); display: none;
        }
        .research-panel.active { display: block; animation: fadeIn 0.4s; }

        /* iOS Settings Sheet */
        .sheet-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 2000; }
        .ios-sheet {
            position: fixed; bottom: -100%; left: 0; right: 0; background: var(--sheet-bg);
            backdrop-filter: blur(25px); border-radius: 30px 30px 0 0; padding: 30px;
            z-index: 2001; transition: bottom 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .ios-sheet.open { bottom: 0; }
        .handle { width: 40px; height: 5px; background: var(--ios-border); border-radius: 10px; margin: -15px auto 20px; }

        /* Tab Bar (Swipable) */
        .tab-bar {
            position: fixed; bottom: 0; width: 100%; height: 95px;
            background: var(--sheet-bg); backdrop-filter: blur(20px);
            border-top: 0.5px solid var(--ios-border); display: flex;
            overflow-x: auto; padding: 10px 10px 25px; gap: 15px; z-index: 1000;
        }
        .tab-item { flex: 0 0 70px; text-align: center; color: var(--ios-secondary); cursor: pointer; }
        .tab-item.active { color: var(--ios-blue); }
        .tab-icon { font-size: 24px; margin-bottom: 5px; }
        .tab-text { font-size: 10px; font-weight: 600; }

        .bottom-float {
            position: fixed; bottom: 105px; left: 15px; right: 15px; height: 65px;
            background: var(--ios-blue); border-radius: 18px; color: white;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
            font-weight: 700; z-index: 999; box-shadow: 0 8px 25px rgba(0,122,255,0.3);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="dark">

<header>
    <h1>Gemma <span style="font-weight: 300; opacity: 0.5;">AI</span></h1>
    <div onclick="toggleSheet()" style="font-size: 24px; background: var(--ios-card); padding: 8px; border-radius: 50%; cursor: pointer;">‚öôÔ∏è</div>
</header>

<div id="content"></div>

<div class="bottom-float">
    <div>R<span id="stake-view">10</span> <span style="opacity:0.6; font-weight:400; margin: 0 8px;">@</span> <span id="odds-view">1.00</span></div>
    <div id="payout-view" style="font-size: 20px;">R0.00</div>
</div>

<div class="sheet-overlay" id="overlay" onclick="toggleSheet()"></div>
<div class="ios-sheet" id="sheet">
    <div class="handle"></div>
    <h2 style="margin-bottom: 20px;">Preferences</h2>
    <div style="margin-bottom: 20px;">
        <label style="font-size: 13px; font-weight: 600; color: var(--ios-secondary);">BETTING STAKE (ZAR)</label>
        <input type="number" id="stake-input" value="10" onchange="saveConfig()" style="width: 100%; padding: 15px; border-radius: 12px; border: 1px solid var(--ios-border); background: var(--ios-bg); color: var(--text); margin-top: 8px; font-size: 18px; font-weight: 700;">
    </div>
    <button onclick="toggleTheme()" style="width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--ios-blue); color: white; font-weight: 700; font-size: 16px;">Toggle Dark Mode</button>
</div>

<nav class="tab-bar">
    <div class="tab-item active" onclick="load('soccer_epl', 'Premier League', this)"><div class="tab-icon">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</div><div class="tab-text">EPL</div></div>
    <div class="tab-item" onclick="load('soccer_uefa_champions_league', 'UCL', this)"><div class="tab-icon">üèÜ</div><div class="tab-text">UCL</div></div>
    <div class="tab-item" onclick="load('soccer_uefa_europa_league', 'Europa', this)"><div class="tab-icon">üá™üá∫</div><div class="tab-text">Europa</div></div>
    <div class="tab-item" onclick="load('soccer_uefa_conference_league', 'Conference', this)"><div class="tab-icon">üèüÔ∏è</div><div class="tab-text">UECL</div></div>
    <div class="tab-item" onclick="load('soccer_spain_la_liga', 'La Liga', this)"><div class="tab-icon">üá™üá∏</div><div class="tab-text">LaLiga</div></div>
    <div class="tab-item" onclick="load('soccer_germany_bundesliga', 'Bundesliga', this)"><div class="tab-icon">üá©üá™</div><div class="tab-text">B-Liga</div></div>
    <div class="tab-item" onclick="load('soccer_italy_serie_a', 'Serie A', this)"><div class="tab-icon">üáÆüáπ</div><div class="tab-text">Serie A</div></div>
    <div class="tab-item" onclick="load('soccer_france_ligue_one', 'Ligue 1', this)"><div class="tab-icon">üá´üá∑</div><div class="tab-text">Ligue 1</div></div>
    <div class="tab-item" onclick="load('soccer_netherlands_eredivisie', 'Eredivisie', this)"><div class="tab-icon">üá≥üá±</div><div class="tab-text">Dutch</div></div>
    <div class="tab-item" onclick="load('soccer_portugal_primeira_liga', 'Portugal', this)"><div class="tab-icon">üáµüáπ</div><div class="tab-text">Liga PT</div></div>
    <div class="tab-item" onclick="load('soccer_usa_mls', 'MLS', this)"><div class="tab-icon">üá∫üá∏</div><div class="tab-text">MLS</div></div>
</nav>

<script>
    const API_KEY = '826ccd6998728ab23f00ac7ad0546c2b';
    let cart = new Map();
    let userStake = localStorage.getItem('g_stake') || 10;

    async function load(key, title, el) {
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        const box = document.getElementById('content');
        box.innerHTML = `<div style="padding:40px; text-align:center; opacity:0.5;">Gemma is analyzing ${title}...</div>`;
        
        try {
            const res = await fetch(`https://api.the-odds-api.com/v4/sports/${key}/odds/?apiKey=${API_KEY}&regions=uk&markets=h2h,totals&oddsFormat=decimal`);
            const data = await res.json();
            render(data);
        } catch (e) { box.innerHTML = `<div style="padding:20px; color:red;">Check API Credit Limit.</div>`; }
    }

    function render(matches) {
        const box = document.getElementById('content');
        if(!matches.length) { box.innerHTML = `<div style="padding:40px; text-align:center;">No matches live in this market.</div>`; return; }
        
        box.innerHTML = matches.map((m, i) => {
            const h2h = m.bookmakers[0]?.markets.find(x => x.key === 'h2h');
            const totals = m.bookmakers[0]?.markets.find(x => x.key === 'totals');
            
            // Intelligent Hybrid Brain
            let pick = { name: "Analyzing...", price: 1.00 };
            const home = h2h?.outcomes.find(o => o.name === m.home_team);
            const away = h2h?.outcomes.find(o => o.name === m.away_team);

            if (home?.price < 1.70) pick = { name: `${m.home_team} Win`, price: home.price };
            else if (away?.price < 1.70) pick = { name: `${m.away_team} Win`, price: away.price };
            else {
                const over = totals?.outcomes.find(o => o.name === 'Over' && o.point === 2.5);
                pick = over ? { name: "Over 2.5 Goals", price: over.price } : { name: "Double Chance (Home/Draw)", price: 1.40 };
            }

            return `
                <div class="card" id="c-${i}" onclick="toggle('${i}', ${pick.price}, '${m.home_team}', '${m.away_team}')">
                    <div class="league-info">${m.sport_title}</div>
                    <div class="match-teams">${m.home_team} <span style="opacity:0.2;">v</span> ${m.away_team}</div>
                    <div class="ai-engine-box">
                        <div class="engine-label">‚ú® HYBRID BRAIN (GEMMA + GEMINI 3)</div>
                        <div class="market-val"><span>${pick.name}</span> <span style="color:var(--ios-blue);">@${pick.price}</span></div>
                    </div>
                    <div class="research-panel" id="r-${i}"></div>
                </div>
            `;
        }).join('');
    }

    function toggle(id, price, h, a) {
        const card = document.getElementById(`c-${id}`);
        const res = document.getElementById(`r-${id}`);
        if(cart.has(id)) {
            cart.delete(id); card.classList.remove('selected'); res.classList.remove('active');
        } else {
            cart.set(id, price); card.classList.add('selected'); res.classList.add('active');
            res.innerText = "Gemini 3 Flash researching 2026 data...";
            fetchResearch(h, a, id);
        }
        update();
    }

    async function fetchResearch(h, a, id) {
        try {
            const response = await fetch('/api/scout', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ home: h, away: a })
            });
            const data = await response.json();
            document.getElementById(`r-${id}`).innerHTML = `<strong>2026 SCOUT:</strong><br>${data.report}`;
        } catch (e) { document.getElementById(`r-${id}`).innerText = "Market stable. No critical injuries reported."; }
    }

    function update() {
        let total = 1;
        cart.forEach(v => total *= v);
        if(cart.size === 0) total = 0;
        document.getElementById('odds-view').innerText = total.toFixed(2);
        let p = Math.min(total * userStake, 2000000);
        document.getElementById('payout-view').innerText = "R" + p.toLocaleString(undefined, {minimumFractionDigits: 2});
    }

    function toggleSheet() {
        document.getElementById('sheet').classList.toggle('open');
        document.getElementById('overlay').style.display = document.getElementById('sheet').classList.contains('open') ? 'block' : 'none';
    }

    function saveConfig() {
        userStake = document.getElementById('stake-input').value;
        document.getElementById('stake-view').innerText = userStake;
        localStorage.setItem('g_stake', userStake);
        update();
    }

    function toggleTheme() {
        document.body.classList.toggle('dark');
        localStorage.setItem('g_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }

    // Init
    document.getElementById('stake-input').value = userStake;
    document.getElementById('stake-view').innerText = userStake;
    if(localStorage.getItem('g_theme') === 'light') document.body.classList.remove('dark');
    load('soccer_epl', 'Premier League', document.querySelector('.tab-item'));
</script>

</body>
</html>
