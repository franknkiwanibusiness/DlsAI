<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoalGetter AI - Pro Research</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #f0f7ff; --card: #ffffff; --accent: #ff6b6b; 
            --ai-purple: #a29bfe; --border: 4px solid #2d3436; 
            --green: #1dd1a1; --yellow: #feca57;
        }

        body { 
            font-family: 'Quicksand', sans-serif; background: var(--bg); 
            padding: 15px; margin: 0; display: flex; flex-direction: column; align-items: center; 
        }

        header { text-align: center; margin-bottom: 20px; width: 100%; }
        h1 { 
            font-family: 'Fredoka One'; font-size: clamp(2.5rem, 10vw, 3.5rem); 
            color: var(--accent); text-shadow: 4px 4px 0px #2d3436; margin: 0; 
        }

        .status-bar { display: flex; gap: 10px; justify-content: center; margin-top: 10px; flex-wrap: wrap; }
        .badge { 
            padding: 8px 15px; border-radius: 15px; border: var(--border); 
            font-weight: bold; background: white; box-shadow: 3px 3px 0px #2d3436; font-size: 0.8rem;
        }

        /* MOBILE FIRST GRID */
        #grid { 
            display: grid; grid-template-columns: 1fr; gap: 25px; 
            width: 100%; max-width: 420px; margin: 20px auto; 
        }

        @media (min-width: 768px) {
            #grid { grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); max-width: 1200px; }
        }

        .card { 
            background: var(--card); border: var(--border); border-radius: 25px; 
            padding: 20px; box-shadow: 10px 10px 0px #2d3436; position: relative;
        }

        .league-tag { font-size: 0.7rem; font-weight: 800; color: #636e72; text-transform: uppercase; margin-bottom: 10px; display: block; }

        .match-row { 
            display: flex; justify-content: space-between; align-items: center; 
            font-weight: 800; font-size: 1.2rem; margin-bottom: 20px; text-align: center;
        }
        .match-row span { flex: 1; }

        /* 3-COLUMN ODDS */
        .odds-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .odd-btn { 
            border: 3px solid #2d3436; border-radius: 12px; padding: 12px 5px; 
            text-align: center; font-weight: 800; transition: 0.1s;
        }
        .h-btn { background: var(--green); color: white; }
        .d-btn { background: #f1f2f6; color: #2d3436; }
        .a-btn { background: var(--accent); color: white; }

        .btn-label { display: block; font-size: 0.65rem; text-transform: uppercase; margin-bottom: 2px; }
        .price { font-size: 1.2rem; font-family: 'Fredoka One'; }

        /* AI SECTION */
        .ai-btn { 
            width: 100%; margin-top: 20px; background: var(--ai-purple); 
            border: 3px solid #2d3436; padding: 12px; border-radius: 15px; 
            cursor: pointer; font-family: 'Fredoka One'; font-size: 1rem;
            box-shadow: 4px 4px 0px #2d3436;
        }
        .ai-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #2d3436; }

        .ai-panel { 
            display: none; margin-top: 15px; padding: 15px; 
            background: #fdfbff; border: 2px dashed var(--ai-purple); 
            border-radius: 15px; font-size: 0.9rem;
        }

        .ai-market-row { 
            display: flex; justify-content: space-between; 
            padding: 5px 0; border-bottom: 1px solid #eee; font-weight: 700;
        }
        .ai-val { color: var(--ai-purple); }
        .ai-explanation { font-size: 0.8rem; font-style: italic; color: #636e72; margin-top: 10px; line-height: 1.4; }
    </style>
</head>
<body>

    <header>
        <h1>GoalGetter AI</h1>
        <div class="status-bar">
            <div id="quota" class="badge">Tokens: --</div>
            <button onclick="forceRefresh()" class="badge" style="background:var(--yellow); cursor:pointer;">Refresh All ‚Üª</button>
        </div>
    </header>

    <div id="grid">
        <div style="grid-column: 1/-1; text-align:center; padding:50px;">Preparing the pitch... ‚öΩ</div>
    </div>

    <script>
        const ODDS_KEY = 'ad7cc474657e32a32bf5d56e68e84fa8';
        const VERCEL_URL = 'https://dlsvalue.site/api/research'; // Replace with your link
        const leagues = ['soccer_epl', 'soccer_spain_la_liga', 'soccer_germany_bundesliga', 'soccer_italy_serie_a', 'soccer_france_ligue_1'];
        const storageKey = `gg_cache_${new Date().toLocaleDateString('en-CA')}`;

        async function init() {
            const cached = localStorage.getItem(storageKey);
            const quota = localStorage.getItem('gg_quota');
            if (cached) {
                document.getElementById('quota').innerText = `Tokens: ${quota || 'Cached'}`;
                render(JSON.parse(cached));
            } else {
                fetchData();
            }
        }

        async function fetchData() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center;">Fetching Live Odds... ‚è≥</div>';
            try {
                let all = [];
                let q = "--";
                for (let l of leagues) {
                    const res = await fetch(`https://api.the-odds-api.com/v4/sports/${l}/odds/?apiKey=${ODDS_KEY}&regions=uk&markets=h2h`);
                    q = res.headers.get('x-requests-remaining') || q;
                    const d = await res.json();
                    if (Array.isArray(d)) all = [...all, ...d];
                }
                localStorage.setItem(storageKey, JSON.stringify(all));
                localStorage.setItem('gg_quota', q);
                document.getElementById('quota').innerText = `Tokens: ${q}`;
                render(all);
            } catch (e) {
                grid.innerHTML = '<div style="color:red; text-align:center;">API Error. Check Key/Connection.</div>';
            }
        }

        function forceRefresh() { localStorage.removeItem(storageKey); fetchData(); }

        function render(matches) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            matches.forEach((m, i) => {
                const bookie = m.bookmakers[0];
                const h2h = bookie?.markets[0]?.outcomes || [];
                const home = h2h.find(o => o.name === m.home_team);
                const draw = h2h.find(o => o.name === 'Draw');
                const away = h2h.find(o => o.name === m.away_team);

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <span class="league-tag">${m.sport_title}</span>
                    <div class="match-row">
                        <span>${m.home_team}</span>
                        <span style="color:var(--accent); font-family:'Fredoka One'; font-size:0.8rem;">VS</span>
                        <span>${m.away_team}</span>
                    </div>
                    <div class="odds-grid">
                        <div class="odd-btn h-btn"><span class="btn-label">Home</span><span class="price">${home?.price || '-'}</span></div>
                        <div class="odd-btn d-btn"><span class="btn-label">Draw</span><span class="price">${draw?.price || '-'}</span></div>
                        <div class="odd-btn a-btn"><span class="btn-label">Away</span><span class="price">${away?.price || '-'}</span></div>
                    </div>
                    <button class="ai-btn" onclick="runAI('${m.home_team}', '${m.away_team}', ${i})">GROQ RESEARCH üß†</button>
                    <div id="ai-${i}" class="ai-panel"></div>
                `;
                grid.appendChild(card);
            });
        }

        async function runAI(home, away, id) {
            const panel = document.getElementById(`ai-${id}`);
            panel.style.display = 'block';
            panel.innerHTML = "üß† Analyzing Form, BTTS, & Corners...";
            
            try {
                const res = await fetch(VERCEL_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ home, away, markets: ['h2h', 'btts', 'totals', 'corners'] })
                });
                const data = await res.json();
                
                // Expecting JSON: { h2h: "", btts: "", goals: "", corners: "", reason: "" }
                panel.innerHTML = `
                    <div class="ai-market-row"><span>Winner Pick</span> <span class="ai-val">${data.h2h}</span></div>
                    <div class="ai-market-row"><span>BTTS</span> <span class="ai-val">${data.btts}</span></div>
                    <div class="ai-market-row"><span>Total Goals</span> <span class="ai-val">${data.goals}</span></div>
                    <div class="ai-market-row"><span>Corners Est.</span> <span class="ai-val">${data.corners}</span></div>
                    <div class="ai-explanation">"${data.reason}"</div>
                `;
            } catch (e) {
                panel.innerText = "Connection failed. Check Vercel URL.";
            }
        }

        init();
    </script>
</body>
</html>
