<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlashBets AI | 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lexend', sans-serif; background: #F0F2F5; -webkit-tap-highlight-color: transparent; }
        .brutal-card { border: 4px solid black; box-shadow: 6px 6px 0px 0px rgba(0,0,0,1); transition: 0.2s; }
        .loading-shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e6e6e6 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body x-data="app()" class="pb-32">

    <nav class="bg-white border-b-4 border-black p-6 sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-2xl font-black italic tracking-tighter uppercase">FLASH<span class="text-lime-500">BETS</span></h1>
        <button @click="refreshData()" class="bg-yellow-400 border-2 border-black px-4 py-1 rounded-xl text-[10px] font-black uppercase">Refresh ðŸ“¡</button>
    </nav>

    <main class="p-4 space-y-6">
        <template x-if="loading"><div class="text-center py-20 animate-pulse font-black uppercase">Scanning Top 7 Leagues...</div></template>

        <template x-for="match in fixtures" :key="match.id">
            <div class="bg-white rounded-[32px] p-5 brutal-card border-4 border-black">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-black text-white px-2 py-1 rounded text-[9px] font-black uppercase" x-text="match.league"></span>
                    <span class="text-[9px] font-black text-gray-400 italic" x-text="match.time"></span>
                </div>

                <div class="flex justify-between items-center text-center gap-2 mb-4">
                    <div class="flex-1 font-black text-xs uppercase" x-text="match.home"></div>
                    <div class="text-gray-200 font-black italic">VS</div>
                    <div class="flex-1 font-black text-xs uppercase" x-text="match.away"></div>
                </div>

                <div class="bg-indigo-50 border-2 border-black border-dashed p-4 rounded-2xl relative">
                    <template x-if="match.loadingAI">
                        <div class="h-10 loading-shimmer rounded-lg"></div>
                    </template>
                    <template x-if="!match.loadingAI">
                        <div>
                            <p class="text-[11px] font-bold leading-tight mb-2" x-text="match.analysis"></p>
                            <div class="flex justify-between items-center">
                                <span class="bg-lime-400 border border-black px-2 py-1 rounded text-[9px] font-black uppercase" x-text="match.best_market"></span>
                                <span class="font-black text-lg" x-text="match.price"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </main>

    <script>
        function app() {
            return {
                fixtures: [], loading: true,
                leagues: ['soccer_epl', 'soccer_spain_la_liga', 'soccer_italy_serie_a', 'soccer_germany_bundesliga', 'soccer_france_ligue_one', 'soccer_portugal_primeira_liga', 'soccer_netherlands_eredivisie'],
                async init() {
                    const cached = localStorage.getItem('fb_cache');
                    if (cached) {
                        const { timestamp, data } = JSON.parse(cached);
                        if (Date.now() - timestamp < 4 * 60 * 60 * 1000) {
                            this.fixtures = data; this.loading = false;
                            this.fixtures.filter(m => m.loadingAI).forEach((m, i) => setTimeout(() => this.fetchAI(m), i * 1000));
                            return;
                        }
                    }
                    await this.refreshData();
                },
                async refreshData() {
                    this.loading = true;
                    try {
                        const promises = this.leagues.map(l => fetch(`https://api.the-odds-api.com/v4/sports/${l}/odds/?apiKey=10257181b61bdaba7ac4ca4e276c9dae&regions=uk&markets=h2h&oddsFormat=decimal`).then(r => r.json()));
                        const results = await Promise.all(promises);
                        const limit = new Date(); limit.setDate(limit.getDate() + 3);
                        this.fixtures = results.flat().filter(f => new Date(f.commence_time) < limit).slice(0, 12).map(f => ({
                            id: f.id, home: f.home_team, away: f.away_team, league: f.sport_title,
                            time: new Date(f.commence_time).toLocaleDateString([], {weekday:'short', hour:'2-digit', minute:'2-digit'}),
                            price: f.bookmakers[0]?.markets[0]?.outcomes[0]?.price || 'N/A',
                            loadingAI: true, analysis: '', best_market: ''
                        }));
                        this.save(); this.loading = false;
                        this.fixtures.forEach((m, i) => setTimeout(() => this.fetchAI(m), i * 1000));
                    } catch (e) { this.loading = false; }
                },
                async fetchAI(match) {
                    try {
                        const res = await fetch('/api/bet', { method: 'POST', body: JSON.stringify({ home: match.home, away: match.away }) });
                        const ai = await res.json();
                        match.analysis = ai.scenario; match.best_market = ai.best_market;
                        match.loadingAI = false; this.save();
                    } catch (e) { match.loadingAI = false; }
                },
                save() { localStorage.setItem('fb_cache', JSON.stringify({ timestamp: Date.now(), data: this.fixtures })); }
            }
        }
    </script>
</body>
</html>
